<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>代码提交&#43;分支管理&#43;版本管理最佳实践 - Hey! Linux</title><meta name="Description" content="以更契合工程师习惯的 YAML 文档格式, 展示约定式提交、分支管理模型、语义化版本与基于源代码的版本等最佳实践。"><meta property="og:url" content="https://blog.heylinux.com/2025/07/commit-branching-versioning-best-practices/">
  <meta property="og:site_name" content="Hey! Linux">
  <meta property="og:title" content="代码提交&#43;分支管理&#43;版本管理最佳实践">
  <meta property="og:description" content="以更契合工程师习惯的 YAML 文档格式, 展示约定式提交、分支管理模型、语义化版本与基于源代码的版本等最佳实践。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-07-30T13:17:40+08:00">
    <meta property="article:modified_time" content="2025-07-30T13:17:40+08:00">
    <meta property="article:tag" content="Git">
    <meta property="article:tag" content="DevOps">
    <meta property="article:tag" content="CICD">
    <meta property="og:image" content="https://blog.heylinux.com/2025/07/commit-branching-versioning-best-practices/featured-image.webp">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://blog.heylinux.com/2025/07/commit-branching-versioning-best-practices/featured-image.webp">
  <meta name="twitter:title" content="代码提交&#43;分支管理&#43;版本管理最佳实践">
  <meta name="twitter:description" content="以更契合工程师习惯的 YAML 文档格式, 展示约定式提交、分支管理模型、语义化版本与基于源代码的版本等最佳实践。">
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.heylinux.com/2025/07/commit-branching-versioning-best-practices/" /><link rel="prev" href="https://blog.heylinux.com/2025/07/cloud-native-glossary-lite/" /><link rel="next" href="https://blog.heylinux.com/2025/09/notes-from-the-lean-startup/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "代码提交+分支管理+版本管理最佳实践",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.heylinux.com\/2025\/07\/commit-branching-versioning-best-practices\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/blog.heylinux.com\/2025\/07\/commit-branching-versioning-best-practices\/featured-image.webp",
                            "width":  1400 ,
                            "height":  488 
                        }],"genre": "posts","keywords": "Git, DevOps, CICD","wordcount":  2660 ,
        "url": "https:\/\/blog.heylinux.com\/2025\/07\/commit-branching-versioning-best-practices\/","datePublished": "2025-07-30T13:17:40+08:00","dateModified": "2025-07-30T13:17:40+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "mcsrainbow","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/blog.heylinux.com\/images\/avatar.jpg",
                    "width":  800 ,
                    "height":  800 
                }},"author": {
                "@type": "Person",
                "name": "郭冬"
            },"description": "以更契合工程师习惯的 YAML 文档格式, 展示约定式提交、分支管理模型、语义化版本与基于源代码的版本等最佳实践。"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>
        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Hey! Linux">Hey! Linux</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"><i class='fas fa-user-circle fa-fw'></i>  </a><a class="menu-item" href="/en/"> English </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="选择语言">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/2025/07/commit-branching-versioning-best-practices/" selected>简体中文</option><option value="/en/2025/07/commit-branching-versioning-best-practices/">English</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Hey! Linux">Hey! Linux</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title=""><i class='fas fa-user-circle fa-fw'></i></a><a class="menu-item" href="/en/" title="">English</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="选择语言">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/2025/07/commit-branching-versioning-best-practices/" selected>简体中文</option><option value="/en/2025/07/commit-branching-versioning-best-practices/">English</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">代码提交+分支管理+版本管理最佳实践</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/about/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>郭冬</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E6%8A%80%E8%83%BD%E7%9F%A9%E9%98%B5/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>技能矩阵</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2025-07-30">2025-07-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 2660 字&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 6 分钟&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/2025/07/commit-branching-versioning-best-practices/featured-image.webp"
        data-srcset="/2025/07/commit-branching-versioning-best-practices/featured-image.webp, /2025/07/commit-branching-versioning-best-practices/featured-image.webp 1.5x, /2025/07/commit-branching-versioning-best-practices/featured-image.webp 2x"
        data-sizes="auto"
        alt="/2025/07/commit-branching-versioning-best-practices/featured-image.webp"
        title="以更契合工程师习惯的 YAML 文档格式, 展示约定式提交、分支管理模型、语义化版本与基于源代码的版本等最佳实践。" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#约定式提交">约定式提交</a>
      <ul>
        <li><a href="#规范">规范</a></li>
        <li><a href="#示例">示例</a></li>
      </ul>
    </li>
    <li><a href="#分支管理模型">分支管理模型</a>
      <ul>
        <li><a href="#gitflow">Gitflow</a></li>
        <li><a href="#github-flow">GitHub Flow</a></li>
        <li><a href="#trunk-based-development">Trunk Based Development</a></li>
        <li><a href="#gitlab-flow">GitLab Flow</a></li>
      </ul>
    </li>
    <li><a href="#版本管理">版本管理</a>
      <ul>
        <li><a href="#标签命名">标签命名</a></li>
        <li><a href="#语义化版本">语义化版本</a></li>
        <li><a href="#基于源代码的版本">基于源代码的版本</a></li>
        <li><a href="#gitlab-ci-版本号生成">GitLab CI 版本号生成</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>以更契合工程师习惯的 YAML 文档格式, 展示约定式提交、分支管理模型、语义化版本与基于源代码的版本等最佳实践。</p>
<hr>
<h2 id="约定式提交">约定式提交</h2>
<h3 id="规范">规范</h3>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">网站</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">https://www.conventionalcommits.org</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">https://github.com/commitizen/conventional-commit-types/blob/master/index.json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">conventional_commits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">feat</span><span class="p">:</span><span class="w">     </span><span class="l">new feature</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">fix</span><span class="p">:</span><span class="w">      </span><span class="l">bug fix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">docs</span><span class="p">:</span><span class="w">     </span><span class="l">documentation only changes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">style</span><span class="p">:</span><span class="w">    </span><span class="l">changes that do not affect the meaning of the code, e.g., white-space, formatting, missing semi-colons</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">refactor</span><span class="p">:</span><span class="w"> </span><span class="l">code change that neither fixes a bug nor adds a feature</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">perf</span><span class="p">:</span><span class="w">     </span><span class="l">code change that improves performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">test</span><span class="p">:</span><span class="w">     </span><span class="l">adding missing tests or correcting existing tests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w">    </span><span class="l">changes that affect the build system or external dependencies, e.g., gulp, broccoli, npm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ci</span><span class="p">:</span><span class="w">       </span><span class="l">changes to our CI configuration files and scripts, e.g., Travis, Circle, BrowserStack, SauceLabs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">chore</span><span class="p">:</span><span class="w">    </span><span class="l">other changes that do not modify src or test files</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revert</span><span class="p">:</span><span class="w">   </span><span class="l">reverts a previous commit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">约定式提交</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">feat</span><span class="p">:</span><span class="w">     </span><span class="l">新功能(feature)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">fix</span><span class="p">:</span><span class="w">      </span><span class="l">修复bug</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">docs</span><span class="p">:</span><span class="w">     </span><span class="l">文档(documents)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">style</span><span class="p">:</span><span class="w">    </span><span class="l">格式, 不影响代码运行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">refactor</span><span class="p">:</span><span class="w"> </span><span class="l">重构</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">perf</span><span class="p">:</span><span class="w">     </span><span class="l">优化(performance), 提升性能或体验</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">test</span><span class="p">:</span><span class="w">     </span><span class="l">测试</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w">    </span><span class="l">构建或依赖项更新</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ci</span><span class="p">:</span><span class="w">       </span><span class="l">持续集成(continuous integration)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">chore</span><span class="p">:</span><span class="w">    </span><span class="l">其它杂务</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revert</span><span class="p">:</span><span class="w">   </span><span class="l">撤销之前的提交</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">structure: &lt;type&gt;(scope)</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;subject&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">动词别名</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">fix</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">resolve</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">handle</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">correct</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">prevent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">update</span></span></span></code></pre></div></div>
<h3 id="示例">示例</h3>
<ul>
<li>
<p>With description and breaking change footer</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">feat</span><span class="p">:</span><span class="w"> </span><span class="l">allow provided config object to extend other configs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">BREAKING CHANGE</span><span class="p">:</span><span class="w"> </span><span class="l">`extends` key in config file is now used for extending other config files</span></span></span></code></pre></div></div>
</li>
<li>
<p>With <code>!</code> to draw attention to breaking change</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">feat!</span><span class="p">:</span><span class="w"> </span><span class="l">send an email to the customer when a product is shipped</span></span></span></code></pre></div></div>
</li>
<li>
<p>With scope and <code>!</code> to draw attention to breaking change</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">feat(api)!</span><span class="p">:</span><span class="w"> </span><span class="l">send an email to the customer when a product is shipped</span></span></span></code></pre></div></div>
</li>
<li>
<p>With both <code>!</code> and BREAKING CHANGE footer</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">chore!</span><span class="p">:</span><span class="w"> </span><span class="l">drop support for Node 6</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">BREAKING CHANGE</span><span class="p">:</span><span class="w"> </span><span class="l">use JavaScript features not available in Node 6.</span></span></span></code></pre></div></div>
</li>
<li>
<p>With no body</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">docs</span><span class="p">:</span><span class="w"> </span><span class="l">correct spelling of CHANGELOG</span></span></span></code></pre></div></div>
</li>
<li>
<p>With scope</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">feat(lang)</span><span class="p">:</span><span class="w"> </span><span class="l">add Polish language</span></span></span></code></pre></div></div>
</li>
<li>
<p>With multi-paragraph body and multiple footers</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">fix</span><span class="p">:</span><span class="w"> </span><span class="l">prevent racing of requests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Introduce a request id and a reference to latest request. Dismiss</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">incoming responses other than from latest request.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Remove timeouts which were used to mitigate the racing issue but are</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">obsolete now.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Reviewed-by</span><span class="p">:</span><span class="w"> </span><span class="l">Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Refs</span><span class="p">:</span><span class="w"> </span><span class="c">#123</span></span></span></code></pre></div></div>
</li>
<li>
<p>With a footer that references the commit SHA that is being reverted</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">revert: feat(lang)</span><span class="p">:</span><span class="w"> </span><span class="l">add Polish language</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">This reverts commit 667ecc1654a317a13331b17617d973392f415f02.</span></span></span></code></pre></div></div>
</li>
</ul>
<h2 id="分支管理模型">分支管理模型</h2>
<h3 id="gitflow">Gitflow</h3>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span><span class="nt">Gitflow</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">网站</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">https://nvie.com/posts/a-successful-git-branching-model/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">描述</span><span class="p">:</span><span class="w"> </span><span class="l">传统工作流, 适合有明确发布周期和多人协作的项目</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">分支</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">feature/*</span><span class="p">:</span><span class="w"> </span><span class="l">功能开发分支, 例如 feature/login, feature/JIRA-985-login</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">bugfix/*</span><span class="p">:</span><span class="w">  </span><span class="l">修复已知的非紧急缺陷, 例如 bugfix/sso-auth, bugfix/JIRA-211-sso-auth</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">develop</span><span class="p">:</span><span class="w">   </span><span class="l">开发集成分支, 合并多个 feature 和 bugfix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">release/*</span><span class="p">:</span><span class="w"> </span><span class="l">候选发布分支, 例如 release/1.6.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">hotfix/*</span><span class="p">:</span><span class="w">  </span><span class="l">生产环境热修复, 例如 hotfix/1.6.3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">main</span><span class="p">:</span><span class="w">      </span><span class="l">生产环境稳定分支</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">流程</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 开发流程: feature/bugfix 从 develop 拉取, 完成后合并回 develop, 再通过 release 合并到 main, 并在 main 上打 tag 标记版本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">develop → feature/bugfix → develop → release → main → tag(vX.Y.Z)[推荐]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 紧急修复: hotfix 从 main 拉取, 完成后合并回 develop 和 main, 并在 main 上打 tag 标记版本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">main → hotfix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="l">↘ develop</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="l">↘ main → tag(vX.Y.Z)[推荐]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">优点</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">明确的分支角色, 适合版本化管理</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">方便管理发布和修复流程</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">缺点</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">分支较多, CI/CD 流程复杂</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">不适合高频率持续交付</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">扩展(可选)</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">分支</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">user/&lt;name&gt;/*</span><span class="p">:</span><span class="w"> </span><span class="l">个人分支, 例如 user/john/login, user/alice/sso-auth</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env/*</span><span class="p">:</span><span class="w">         </span><span class="l">环境分支, 例如 env/uat, env/prod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">说明</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">user/&lt;name&gt;/* 仅用于个人实验或独立开发, 不保证会合并, 避免污染正式功能分支</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">env/* 仅用于跟踪各环境当前部署版本, 不直接开发代码, 更新通过合并提交</span></span></span></code></pre></div></div>
<h3 id="github-flow">GitHub Flow</h3>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span><span class="nt">GitHubFlow</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">网站</span><span class="p">:</span><span class="w"> </span><span class="l">https://docs.github.com/en/get-started/using-github/github-flow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">描述</span><span class="p">:</span><span class="w"> </span><span class="l">简化流程, 适合持续交付和小团队</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">分支</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">main</span><span class="p">:</span><span class="w">      </span><span class="l">唯一的长期分支, 始终保持可发布状态, 是否发布由团队策略决定</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">feature/*</span><span class="p">:</span><span class="w"> </span><span class="l">从 main 派生的功能分支</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">流程</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 功能开发: feature 从 main 拉取, 完成后通过 Pull/Merge Request 合并回 main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 发布版本: 在 main 上打 tag 标记可发布版本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">main → feature → main → tag(vX.Y.Z)[推荐]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">优点</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">流程简单, 适合快速迭代</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">结合 Pull/Merge Request 审核</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">缺点</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">缺少稳定的开发集成分支</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">版本控制需要依赖 tag</span></span></span></code></pre></div></div>
<h3 id="trunk-based-development">Trunk Based Development</h3>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span><span class="nt">TrunkBasedDevelopment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">网站</span><span class="p">:</span><span class="w"> </span><span class="l">https://cn.trunkbaseddevelopment.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">描述</span><span class="p">:</span><span class="w"> </span><span class="l">主干开发, 极简工作流, 适合持续集成/每日构建</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">分支</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">main</span><span class="p">:</span><span class="w">      </span><span class="l">唯一的主干分支 (Trunk)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">feature/*</span><span class="p">:</span><span class="w"> </span><span class="l">非常短期的功能分支, 快速合并回 main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">流程</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 功能开发: feature 从 main 拉取, 短周期开发后快速合并回 main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 持续发布: 每次 main 合并都可触发构建和发布</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">main → feature → main → tag(vX.Y.Z)[可选]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">说明</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">由于合并频繁, 通常使用 `datetime + commit_hash` 作为版本号, 例如 2025.07.30.1906.3f9a7c1d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">语义化版本 (vX.Y.Z) 仅用于重要的里程碑 tag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">优点</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">支持高频率发布, 自动化 CI/CD 友好</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">避免长期分支造成代码漂移(长期未合并导致代码差异累积)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">缺点</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">需要强大的测试和自动化保障</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">对团队协作要求高</span></span></span></code></pre></div></div>
<h3 id="gitlab-flow">GitLab Flow</h3>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span><span class="nt">GitLabFlow</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">网站</span><span class="p">:</span><span class="w"> </span><span class="l">https://about.gitlab.com/blog/gitlab-flow-duo/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">描述</span><span class="p">:</span><span class="w"> </span><span class="l">GitLab 官方推荐的工作流, 结合主干开发与环境分支, 适合多环境 CI/CD 部署</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">分支</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">feature/*</span><span class="p">:</span><span class="w">  </span><span class="l">功能开发分支, 从 main 派生, 完成后通过 Merge Request 合并回 main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">main</span><span class="p">:</span><span class="w">       </span><span class="l">主分支, 用于集成和测试, 始终保持可合并状态</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">staging</span><span class="p">:</span><span class="w">    </span><span class="l">预发布环境分支, 用于上线前验证</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">production</span><span class="p">:</span><span class="w"> </span><span class="l">生产环境分支, 跟踪当前线上部署版本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">流程</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 功能开发: feature 从 main 拉取, 完成后合并回 main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 部署流程: main 合并到 staging 触发预发布, main 合并到 production 触发生产部署</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 可选发布: 在 production 上打 tag 标记生产版本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">main → feature → main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                         </span><span class="l">↘ staging</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                         </span><span class="l">↘ production → tag(vX.Y.Z)[推荐]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">说明</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">staging/production 分支用于跟踪各环境当前部署版本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">更新环境分支通过合并提交完成, 不直接在这些分支上开发代码</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">main 合并到 production 时推荐打 tag 标记正式发布版本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">优点</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">支持多环境部署, CI/CD 友好</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">通过环境分支管理发布, 直观跟踪当前部署状态</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">保持 main 分支简洁, 功能通过 Merge Request 控制</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">缺点</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">需要严格的合并策略和 CI/CD 约定</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">对小型项目可能过于复杂</span></span></span></code></pre></div></div>
<h2 id="版本管理">版本管理</h2>
<h3 id="标签命名">标签命名</h3>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version_label</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">snapshot</span><span class="p">:</span><span class="w"> </span><span class="l">开发快照</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">alpha</span><span class="p">:</span><span class="w">    </span><span class="l">内部测试</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">beta</span><span class="p">:</span><span class="w">     </span><span class="l">公开测试</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rc</span><span class="p">:</span><span class="w">       </span><span class="l">候选发布</span><span class="w"> </span><span class="c"># Release Candidate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">release</span><span class="p">:</span><span class="w">  </span><span class="l">正式发布</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hotfix</span><span class="p">:</span><span class="w">   </span><span class="l">紧急修复</span></span></span></code></pre></div></div>
<h3 id="语义化版本">语义化版本</h3>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">语义化版本</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">英文</span><span class="p">:</span><span class="w"> </span><span class="l">Semantic Versioning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">网站</span><span class="p">:</span><span class="w"> </span><span class="l">https://semver.org</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">格式</span><span class="p">:</span><span class="w"> </span><span class="l">MAJOR.MINOR.PATCH</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">初始化开发版本</span><span class="p">:</span><span class="w"> </span><span class="m">0.1.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">说明</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">MAJOR</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">描述</span><span class="p">:</span><span class="w"> </span><span class="l">主版本号</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">场景</span><span class="p">:</span><span class="w"> </span><span class="l">不兼容的修改</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">示例</span><span class="p">:</span><span class="w"> </span><span class="m">0.12.8</span><span class="w"> </span><span class="l">→ 1.0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">规则</span><span class="p">:</span><span class="w"> </span><span class="l">主版本号 +1, 次版本号和修订号归零</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">MINOR</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">描述</span><span class="p">:</span><span class="w"> </span><span class="l">次版本号</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">场景</span><span class="p">:</span><span class="w"> </span><span class="l">向下兼容的功能性新增</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">示例</span><span class="p">:</span><span class="w"> </span><span class="m">1.5.1</span><span class="w"> </span><span class="l">→ 1.6.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">规则</span><span class="p">:</span><span class="w"> </span><span class="l">次版本号 +1, 修订号归零</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">PATCH</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">描述</span><span class="p">:</span><span class="w"> </span><span class="l">修订号</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">场景</span><span class="p">:</span><span class="w"> </span><span class="l">向下兼容的问题修正</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">示例</span><span class="p">:</span><span class="w"> </span><span class="m">1.6.1</span><span class="w"> </span><span class="l">→ 1.6.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">规则</span><span class="p">:</span><span class="w"> </span><span class="l">修订号 +1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">预发布版本</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">格式</span><span class="p">:</span><span class="w"> </span><span class="l">MAJOR.MINOR.PATCH-&lt;label&gt;[.&lt;identifier&gt;]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">标签</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">alpha</span><span class="p">:</span><span class="w"> </span><span class="l">内部测试版</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">beta</span><span class="p">:</span><span class="w">  </span><span class="l">公开测试版</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">rc</span><span class="p">:</span><span class="w">    </span><span class="l">候选发布版 </span><span class="w"> </span><span class="c"># Release Candidate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">示例</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.12.6</span>-<span class="l">alpha</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.12.6</span>-<span class="l">beta</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.12.6</span>-<span class="l">rc.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.12.6</span>-<span class="l">rc.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">元数据</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">格式</span><span class="p">:</span><span class="w"> </span><span class="l">MAJOR.MINOR.PATCH[-&lt;label&gt;]+&lt;metadata&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">示例</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.12.6</span>-<span class="l">alpha+3f9a7c1d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.12.7+20250730</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">版本演进路线示例</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    0.1.0 → 0.1.1 → ...
</span></span></span><span class="line"><span class="cl"><span class="sd">      ↓
</span></span></span><span class="line"><span class="cl"><span class="sd">     ...
</span></span></span><span class="line"><span class="cl"><span class="sd">      ↓
</span></span></span><span class="line"><span class="cl"><span class="sd">    0.12.8
</span></span></span><span class="line"><span class="cl"><span class="sd">      ↓
</span></span></span><span class="line"><span class="cl"><span class="sd">    1.0.0
</span></span></span><span class="line"><span class="cl"><span class="sd">      ↓
</span></span></span><span class="line"><span class="cl"><span class="sd">     ...
</span></span></span><span class="line"><span class="cl"><span class="sd">      ↓
</span></span></span><span class="line"><span class="cl"><span class="sd">    1.5.1
</span></span></span><span class="line"><span class="cl"><span class="sd">      ↓
</span></span></span><span class="line"><span class="cl"><span class="sd">    1.6.0 → 1.6.1 → 1.6.2
</span></span></span><span class="line"><span class="cl"><span class="sd">      ↓
</span></span></span><span class="line"><span class="cl"><span class="sd">     ...
</span></span></span><span class="line"><span class="cl"><span class="sd">      ↓
</span></span></span><span class="line"><span class="cl"><span class="sd">    1.12.6-alpha(1.12.6-alpha+3f9a7c1d) → 1.12.6-beta → 1.12.6-rc.1 → 1.12.6-rc.2
</span></span></span><span class="line"><span class="cl"><span class="sd">      ↓
</span></span></span><span class="line"><span class="cl"><span class="sd">    1.12.7(1.12.7+20250730)</span></span></span></code></pre></div></div>
<h3 id="基于源代码的版本">基于源代码的版本</h3>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">基于源代码的版本</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">英文</span><span class="p">:</span><span class="w"> </span><span class="l">Source-based Versioning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">格式</span><span class="p">:</span><span class="w"> </span><span class="l">YYYY.mm.dd.HHMM-&lt;branch&gt;-&lt;commit_hash&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">说明</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">YYYY.mm.dd.HHMM</span><span class="p">:</span><span class="w"> </span><span class="l">构建日期时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l">分支</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">commit_hash</span><span class="p">:</span><span class="w"> </span><span class="l">短哈希值(前8位字符)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">示例</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">2025.07.28.1802</span>-<span class="l">feature-login-c4d8b21e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">2025.07.29.1752</span>-<span class="l">develop-b17e5a9f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">2025.07.30.1906</span>-<span class="l">main-3f9a7c1d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">优点</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">直接显示构建来源分支</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">每个版本唯一且可追溯到具体提交</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">适合自动化持续集成</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">扩展规则</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">带发布标签</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">格式</span><span class="p">:</span><span class="w"> </span><span class="l">YYYY.mm.dd.HHMM-&lt;branch&gt;-&lt;commit_hash&gt;-&lt;label&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">标签</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">alpha</span><span class="p">:</span><span class="w"> </span><span class="l">内部测试版</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">beta</span><span class="p">:</span><span class="w">  </span><span class="l">公开测试版</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">rc</span><span class="p">:</span><span class="w">    </span><span class="l">候选发布版 </span><span class="w"> </span><span class="c"># Release Candidate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">示例</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">2025.07.30.1906</span>-<span class="l">main-3f9a7c1d-alpha</span></span></span></code></pre></div></div>
<h3 id="gitlab-ci-版本号生成">GitLab CI 版本号生成</h3>
<p>生成 MAGIC_VERSION 变量</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># .gitlab-ci.magic-version.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 使用 GitLab 的保留阶段 .pre, 确保版本号在所有自定义阶段之前生成</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 在 .pre 阶段导出的 artifacts.reports.dotenv 会被 GitLab 自动注入到所有后续阶段的 Job 环境</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 后续 Job 可以直接使用 $MAGIC_VERSION, 无需显式 dependencies: 或 needs:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">stages</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">.pre</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 基于 tag 的版本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">generate-magic-version-tag</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l">.pre</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l">$CI_COMMIT_TAG        </span><span class="w"> </span><span class="c"># 当基于 tag 构建时运行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 取当前 $CI_COMMIT_TAG 值, 例如 v1.2.3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">export MAGIC_VERSION=$CI_COMMIT_TAG</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 把版本号写入 build.env, 供后续 Job 使用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">echo &#34;MAGIC_VERSION=$MAGIC_VERSION&#34; &gt;&gt; build.env</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 打印 build.env 便于调试</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">cat build.env</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># 导出 build.env 作为 artifacts.reports.dotenv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># GitLab 会自动注入到后续阶段</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l">build.env</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 基于 分支 的版本</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">generate-magic-version-branch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l">.pre</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l">$CI_COMMIT_BRANCH     </span><span class="w"> </span><span class="c"># 当基于 分支 构建时运行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 生成日期时间, 格式为 YYYY.mm.dd.HHMM, 例如 2025.07.30.1906</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">VERSION_DATETIME=$(date +&#39;%Y.%m.%d.%H%M&#39;)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 拼接版本号：YYYY.mm.dd.HHMM-&lt;branch&gt;-&lt;commit_hash&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 例如：2025.07.30.1906-main-3f9a7c1d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 变量说明：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c">#   $CI_COMMIT_REF_SLUG  -&gt; 分支名 slug, 例如 feature-login / main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c">#   $CI_COMMIT_SHORT_SHA -&gt; 当前提交的短哈希值(前8位字符)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">export MAGIC_VERSION=${VERSION_DATETIME}-${CI_COMMIT_REF_SLUG}-${CI_COMMIT_SHORT_SHA}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 把版本号写入 build.env, 供后续 Job 使用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">echo &#34;MAGIC_VERSION=$MAGIC_VERSION&#34; &gt;&gt; build.env</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 打印 build.env 便于调试</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">cat build.env</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># 导出 build.env 作为 artifacts.reports.dotenv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># GitLab 会自动注入到后续阶段</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l">build.env</span></span></span></code></pre></div></div>
<p>在后续阶段的 Job 中直接引用 MAGIC_VERSION 变量</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="复制到剪贴板"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># .gitlab-ci.delivery.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 构建并发布 Docker 镜像</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">publish-dockerimage</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l">delivery</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cache</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker:24.0.5-cli</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">docker:24.0.5-dind</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">variables</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># CS_IMAGE 是 GitLab Container Scanning 默认识别的镜像变量</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># https://docs.gitlab.com/user/application_security/container_scanning/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">CS_IMAGE</span><span class="p">:</span><span class="w"> </span><span class="l">$CI_REGISTRY_IMAGE:$MAGIC_VERSION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 登录 GitLab Docker Registry</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 使用 $CS_IMAGE 构建镜像</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">docker build -t $CS_IMAGE .</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 推送镜像到 GitLab Docker Registry</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">docker push $CS_IMAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 将构建的镜像写入 build.env</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">echo &#34;CS_IMAGE=$CS_IMAGE&#34; &gt;&gt; build.env</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 打印 build.env 便于调试</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">cat build.env</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># 导出 build.env 作为 artifacts.reports.dotenv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># 便于后续容器扫描或部署阶段使用</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">dotenv</span><span class="p">:</span><span class="w"> </span><span class="l">build.env</span></span></span></code></pre></div></div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2025-07-30</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2025/07/commit-branching-versioning-best-practices/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 X" data-sharer="x" data-url="https://blog.heylinux.com/2025/07/commit-branching-versioning-best-practices/" data-title="代码提交&#43;分支管理&#43;版本管理最佳实践" data-hashtags="Git,DevOps,CICD"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Linkedin" data-sharer="linkedin" data-url="https://blog.heylinux.com/2025/07/commit-branching-versioning-best-practices/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://blog.heylinux.com/2025/07/commit-branching-versioning-best-practices/" data-title="代码提交&#43;分支管理&#43;版本管理最佳实践" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Reddit" data-sharer="reddit" data-url="https://blog.heylinux.com/2025/07/commit-branching-versioning-best-practices/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=https%3a%2f%2fblog.heylinux.com%2f2025%2f07%2fcommit-branching-versioning-best-practices%2f&amp;text=%e4%bb%a3%e7%a0%81%e6%8f%90%e4%ba%a4%2b%e5%88%86%e6%94%af%e7%ae%a1%e7%90%86%2b%e7%89%88%e6%9c%ac%e7%ae%a1%e7%90%86%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" target="_blank" title="分享到 Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/git/">Git</a>,&nbsp;<a href="/tags/devops/">DevOps</a>,&nbsp;<a href="/tags/cicd/">CICD</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2025/07/cloud-native-glossary-lite/" class="prev" rel="prev" title="云原生词汇表之精简版"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>云原生词汇表之精简版</a>
            <a href="/2025/09/notes-from-the-lean-startup/" class="next" rel="next" title="读书笔记之《精益创业：新创企业的成长思维》">读书笔记之《精益创业：新创企业的成长思维》<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="giscus" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://giscus.app">Giscus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2021 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/about/" target="_blank">mcsrainbow</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.20.2/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js"></script><script>window.config={"code":{"maxShownLines":100},"comment":{"giscus":{"category":"Announcements","categoryId":"DIC_kwDOJ24LIc4CtzPW","darkTheme":"dark","emitMetadata":"0","inputPosition":"bottom","lang":"zh-CN","lazyLoading":false,"lightTheme":"light","mapping":"pathname","reactionsEnabled":"0","repo":"mcsrainbow/mcsrainbow.github.io","repoId":"R_kgDOJ24LIQ"}},"lightgallery":true,"search":{"algoliaAppID":"T37NSH4YYY","algoliaIndex":"index.zh-cn","algoliaSearchKey":"2b7d83ac63406ccc989a0857442fef17","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script src="/js/theme.min.js"></script></body>
</html>
